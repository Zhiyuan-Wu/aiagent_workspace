---
name: coding-agent
description: Run Claude Code Coding Agent via background process for programmatic control. Use Claude Code whenever you need to write code; never write code yourself.
metadata:
  {
    "openclaw": { "emoji": "üß©", "requires": { "anyBins": ["claude", "codex", "opencode", "pi"] } },
  }
---
# Coding Agent (Bash-First)

Use the **`exec`** command‚Äî**always with `background: true`, `pty: true`, and `timeout: 86400`**‚Äîto launch a Claude Code Agent for all coding work, as well as most general-purpose technical tasks. Simple and effective.

**Important Notes:**
1. **Always use `pty: true`** ‚Äî Claude Code agents require a terminal environment to function properly.
2. The `exec` command has a default timeout of 1800 seconds (30 minutes). However, Claude Code is designed to handle much longer runs. Set the timeout to a large value such as **86400** (24 hours). Be patient‚Äîdo not terminate sessions merely because they appear "slow."
3. Since `exec` may occasionally fail to correctly parse extremely long command strings, the best practice is to **first write your full task instructions into a file** (e.g., `~/.openclaw/workspace/claude_tasks/task_YYMMDD_hhmmss.txt`), then give Claude Code a concise instruction like:  
   `'Read /absolute/path/to/task_xxx.txt for work details.'` (See example below.)
4. Use the **`process`** tool to query task status. Monitor progress via `process:log`.

---

# Claude Code CLI Best Practices

## Workflow Guidelines

1.  **Write a comprehensive task description** to a timestamped file using the `write` tool. Use a descriptive filename such as:  `/absolute/path/to/task_20260101_140721_some_job.txt`

   **Important Note:** You **MUST** include all of the following elements in your task description (see the next section for an example):  
   *   **Length:** Do not exceed 2000 words.  
   *   **Structure:** Include necessary background, the overall objective, a brief idea or approach, important notes and requirements, and a clear list of deliverables.  
   *   **Context:** If this task is part of a sequence, be sure to include a concise summary of prior tasks in the background‚Äîcovering their objectives, relevant files, key findings, and outstanding issues. This context provides invaluable reference for Claude Code and significantly increases the likelihood of successful execution.  
   *   **Focus on the "What":** Clearly define *what* needs to be done, but **never** provide sample solutions or pre-written code. Leave all implementation details to Claude Code.  
   *   **Notification:** Explicitly require the agent to notify you upon task completion or need intervention; otherwise, tasks may terminate silently without feedback.  
   *   **Logging:** Mandate that all experiments or scripts log intermediate results and outputs to persistent files, enabling you to monitor the agent‚Äôs progress and debug if necessary.  
   *   **Reporting:** Require the generation of a final summary report that consolidates findings, outcomes, and any recommendations.

2.  **Launch the agent** using the `exec` tool with the required flags **(`background: true`, `pty: true`, `timeout: 86400`)**:
    ```bash
    cd /path/to/project && claude 'Read /absolute/path/to/task_xxx.txt for work details.' --allowedTools 'Bash,Read,Edit,Write,WebFetch'
    ```

3.  **Monitor progress regularly** using the `process:log` tool. Also check the code repo to see code modification and result file generated by Claude Code. Add a follow-up item to `HEARTBEAT.md` for later verification, and provide periodic updates to the user. Be patient‚ÄîClaude Code tasks can take a long time (it's normal for complex tasks to take over an hour, especially when many comparative experiments are involved). **Check result in repo, Claude may not inform you directly**

4.  **Following Actions** If you need to provide additional instructions or clarifications to a running Claude Code session (e.g., adding a brief requirement or asking it to re-read the task file), use the `process:submit` tool (not `process:write`, which only writes to the session input buffer without triggering submission).
---

## Key Instructions to Include in Your Task Description

**1. Final Notification Instruction:**
Include the following at the end of your task description to ensure Claude Code notifies you upon completion:
```text
When completely finished or need intervention, run this command to inform me:
openclaw gateway wake --text "(Claude Code's return message or next step suggestions)" --mode now
```

**2. Logging Instruction for Experiments/Scripts:**
If your task involves running experiments or scripts, include the following to ensure progress is visible:
```text
When running any scripts (e.g., Python), ensure they log key steps, output intermediate results, and print final data to a well-named file (e.g., by running `python3 your_script.py > experiment_log_YYYYMMDD_HHMMSS.txt`).
```

**3. Instruction for Long-Running Experiments:**
If your task involves experiments that are expected to run for an extended duration, include the following to instruct Claude Code to report intermediate results promptly:
```text
For long-running experiments, execute them in incremental stages. After each stage, save and report intermediate results (e.g., metrics, checkpoints, or logs) before proceeding to the next stage. Do not wait until the entire experiment finishes to provide updates.
```

## Trouble Shooting

**1. Claude seems stuck**
Claude Code may complete actual work but forget to write reports to expected locations or notify you upon completion (even if you explicitly asked it to). It is important to check any possible results yourself. You need to carefully examine all file changes (for example, through git or by checking file modification dates) to find possible code modifications or log outputs, in order to determine whether the task is truly stuck or just hasn't provided feedback.

**2. Recover from 429 Too Many Requests**
If you recently recover from a 429 Too Many Requests error, it's possible that launched Claude Code sessions may have been silently terminated without notification. Check your recent processes and their logs to identify their status. Send a follow-up message "Go on" will recover them.

## What Can Claude Code Do?

You can delegate virtually **any technical or analytical task** to Claude Code‚Äîfrom professional software engineering to orchestrating multi-hour experiments. Its capabilities include:

### üßë‚Äçüíª **Professional Coding & Development**
*   Build full applications from scratch or extend existing codebases
*   Refactor and optimize code for performance, readability, or maintainability
*   Debug issues by analyzing logs and tracing root causes
*   Write comprehensive tests (unit, integration, E2E) and documentation
*   Implement APIs, data pipelines, and automation scripts

### üî¨ **Experimentation & Analysis**
*   Run multi-step experiments with automated data collection and validation
*   Clean, transform, and analyze datasets (including statistical analysis)
*   Generate visualizations and reports to communicate insights
*   Simulate scenarios or model complex systems
*   Monitor long-running processes and handle intermediate outputs

### üõ†Ô∏è **System & DevOps Tasks**
*   Configure development environments and CI/CD pipelines
*   Manage infrastructure using Infrastructure-as-Code (IaC) templates
*   Automate repetitive workflows across platforms
*   Perform large-scale file operations (batch renaming, format conversion, etc.)
*   Interact programmatically with databases, APIs, and external services

### üìö **Learning & Exploration**
*   Research technical topics by exploring documentation and real-world examples
*   Create tutorials, demos, or interactive learning materials
*   Rapidly prototype new ideas to validate feasibility
*   Compare technologies through benchmark implementations

---
